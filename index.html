<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homelab Dashboard</title>
    <meta name="description" content="Personal homelab service dashboard">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Performance optimizations -->
    <link rel="dns-prefetch" href="//Joshivps1-ocp">
    <link rel="dns-prefetch" href="//Joshi1.com">
    <link rel="dns-prefetch" href="//login.tailscale.com">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="assets/logos/n8n-logo.webp" as="image">
    <link rel="preload" href="assets/logos/uptime-kuma-logo.png" as="image">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
</head>
<body>
    <!-- Skip Navigation Link for Screen Readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="container">
        <header class="header" role="banner">
            <h1>üè† Joshi Homelab</h1>
            <div class="system-info" role="region" aria-label="System status information">
                <div class="stat">
                    <div class="stat-label">Services</div>
                    <div class="stat-value" id="service-count" aria-live="polite" aria-label="Number of services">Loading...</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Uptime</div>
                    <div class="stat-value" id="uptime-percentage" aria-live="polite" aria-label="System uptime percentage">--</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Last Update</div>
                    <div class="stat-value" id="last-update" aria-live="polite" aria-label="Last system update time">--:--</div>
                </div>
            </div>
            <div class="header-controls" role="toolbar" aria-label="Dashboard controls">
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle between light and dark theme" title="Toggle theme (T)" accesskey="t">üåô</button>
                <button id="search-open" class="theme-toggle" aria-label="Open search dialog" title="Search services (‚åòK)" accesskey="k">üîç</button>
                <a href="uptime.html" class="theme-toggle" aria-label="View uptime monitoring dashboard" title="Uptime Monitoring (U)" accesskey="u">üìä</a>
                <a href="about.html" class="theme-toggle" aria-label="View information about this dashboard" title="About this dashboard (A)" accesskey="a">‚ÑπÔ∏è</a>
            </div>
            <div class="live-time" id="live-time" role="timer" aria-label="Current date and time">
                <div class="time-display" id="current-time" aria-live="polite">--:--:--</div>
                <div class="date-display" id="current-date" aria-live="polite">-- -- ----</div>
            </div>
        </header>
        <!-- Service Categories Container -->
        <div class="service-categories" id="main-content" role="main" aria-label="Service categories and monitoring">
            <!-- Core Services Category -->
            <div class="service-category" data-category="core" role="region" aria-labelledby="core-category-title">
                <div class="category-header" 
                     onclick="toggleCategory('core')" 
                     onkeydown="handleCategoryKeydown(event, 'core')"
                     tabindex="0" 
                     role="button" 
                     aria-expanded="true" 
                     aria-controls="core-content"
                     aria-label="Core Services category, click to expand or collapse">
                    <div class="category-title">
                        <span class="category-icon" aria-hidden="true">üöÄ</span>
                        <h2 id="core-category-title">Core Services</h2>
                        <span class="category-count" id="core-count" aria-label="4 services in this category">4</span>
                    </div>
                    <div class="category-toggle" aria-hidden="true">
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                </div>
                <div class="category-content" id="core-content" role="region" aria-labelledby="core-category-title">
                    <div class="services-grid" role="list" aria-label="Core services list">
                        <a href="http://Joshivps1-ocp:5678" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="service-card"
                           role="listitem"
                           aria-label="n8n workflow automation service, running on port 5678"
                           title="Open n8n workflow automation service">
                            <div class="service-icon" aria-hidden="true">
                                <img src="assets/logos/n8n-logo.webp" alt="" loading="eager" width="72" height="72">
                            </div>
                            <div class="service-info">
                                <h3>n8n</h3>
                                <p>Workflow Automation</p>
                                <span class="service-port" aria-label="Port 5678">:5678</span>
                            </div>
                        </a>
                        <a href="https://Joshi1.com" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="service-card"
                           role="listitem"
                           aria-label="Joshi1.com personal website, publicly accessible"
                           title="Open Joshi1.com personal website">
                            <div class="service-icon" aria-hidden="true">
                                <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #0ea5e9, #22c55e); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üåê</div>
                            </div>
                            <div class="service-info">
                                <h3>Joshi1.com</h3>
                                <p>Personal website</p>
                                <span class="service-port" aria-label="Publicly accessible">Public</span>
                            </div>
                        </a>
                        <a href="http://Joshivps1-ocp:8000" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="service-card is-down" 
                           role="listitem"
                           aria-label="Paperless-ngx document management system, currently down, running on port 8000"
                           title="Paperless-ngx service is currently down"
                           aria-disabled="true" 
                           tabindex="-1">
                            <div class="status-banner down" aria-label="Service is down">Down</div>
                            <div class="service-icon" aria-hidden="true">
                                <img src="assets/logos/paperless-ngx-logo.png" alt="" loading="lazy" width="72" height="72">
                            </div>
                            <div class="service-info">
                                <h3>Paperless-ngx</h3>
                                <p>Document Management System</p>
                                <span class="service-port" aria-label="Port 8000">:8000</span>
                            </div>
                        </a>
                        <a href="https://portainer.joshi1.com/#!/home" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="service-card"
                           role="listitem"
                           aria-label="Portainer Docker container management, publicly accessible"
                           title="Open Portainer Docker management interface">
                            <div class="service-icon" aria-hidden="true">
                                <img src="https://res.cloudinary.com/canonical/image/fetch/f_auto,q_auto,fl_sanitize,c_fill,w_200,h_200/https://api.charmhub.io/api/v1/media/download/charm_Owpj9CsDEMZwVtup3ZTxxs0FtyvDqb2o_icon_5cef79c2d18f67464f39c8f2cf2d7ebb815b0071f04d3ffbb94f49fddd3ab666.png" alt="" loading="lazy" width="72" height="72">
                            </div>
                            <div class="service-info">
                                <h3>Portainer</h3>
                                <p>Docker & container management</p>
                                <span class="service-port" aria-label="Publicly accessible">Public</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Monitoring stuff :))) -->
            <div class="service-category" data-category="monitoring">
                <div class="category-header" onclick="toggleCategory('monitoring')">
                    <div class="category-title">
                        <span class="category-icon">üìä</span>
                        <h2>Monitoring & Analytics</h2>
                        <span class="category-count" id="monitoring-count">2</span>
                    </div>
                    <div class="category-toggle">
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                </div>
                <div class="category-content" id="monitoring-content">
                    <div class="analytics-grid">
                        <a href="http://Joshivps1-ocp:3001" target="_blank" rel="noopener noreferrer" class="analytics-card">
                            <div class="analytics-icon">
                                <img src="assets/logos/uptime-kuma-logo.png" alt="Uptime Kuma" loading="lazy" width="72" height="72">
                            </div>
                            <div class="analytics-info">
                                <h3>Uptime Kuma</h3>
                                <p>Service uptime monitoring and statistics</p>
                            </div>
                        </a>
                        <a href="https://login.tailscale.com/admin/machines" target="_blank" rel="noopener noreferrer" class="analytics-card">
                            <div class="analytics-icon">
                                <img src="assets/logos/tailscale-logo.png" alt="Tailscale" loading="lazy" width="72" height="72">
                            </div>
                            <div class="analytics-info">
                                <h3>Tailscale</h3>
                                <p>Zero Trust Network Access & Device Management</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Family Apps Category -->
            <div class="service-category" data-category="family">
                <div class="category-header" onclick="toggleCategory('family')">
                    <div class="category-title">
                        <span class="category-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        <h2>Family Apps</h2>
                        <span class="category-count" id="family-count">1</span>
                    </div>
                    <div class="category-toggle">
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                </div>
                <div class="category-content" id="family-content">
                    <div class="services-grid">
                        <a href="shop.html" class="service-card">
                            <div class="service-icon">
                                <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #ff6b6b, #ffa500); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">üèÜ</div>
                            </div>
                            <div class="service-info">
                                <h3>Beacon Points</h3>
                                <p>Earn and spend points in the house shop</p>
                                <span class="service-port">Family</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // Only disable right-click on sensitive elements
            document.addEventListener('contextmenu', function(e) {
                // Allow right-click on input fields and text areas
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }
                // Show a friendly message instead of blocking
                e.preventDefault();
                console.log('üîí This is a private homelab dashboard. Please respect the system.');
                return false;
            });
            
            // Disable common dev tools shortcuts (but allow debugging in development)
            document.addEventListener('keydown', function(e) {
                // Only block in production-like environments
                if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                    if (e.key === 'F12' || 
                        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                        (e.ctrlKey && e.key === 'U')) {
                        e.preventDefault();
                        console.log('üîí Developer tools are restricted on this dashboard.');
                        return false;
                    }
                }
            });
            
            // Gentle devtools detection (no redirect, just logging)
            let devtools = {open: false, orientation: null};
            const threshold = 160;
            setInterval(function() {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        console.log('üîí Developer tools detected. This is a private homelab dashboard.');
                    }
                } else {
                    devtools.open = false;
                }
            }, 1000); // Less frequent checks
            
            // Allow text selection for better UX
            // Removed the selectstart and dragstart blocking
        })();

        function updateLiveTime() {
            const now = new Date();
            
            // Update live clock (every second)
            const timeString = now.toLocaleTimeString('en-US', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
            
            // Update date display
            const dateString = now.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
            document.getElementById('current-date').textContent = dateString;
        }

        // Update timestamp for "Updated" field (every minute)
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('last-update').textContent = now.toLocaleTimeString();
        }

        // Real-time monitoring functions
        let monitoringData = {
            services: [],
            uptime: 0,
            lastUpdate: null
        };

        async function fetchMonitoringData() {
            try {
                const response = await fetch('/api/monitoring');
                if (response.ok) {
                    const data = await response.json();
                    monitoringData = data;
                    updateMonitoringDisplay();
                } else {
                    console.warn('Failed to fetch monitoring data');
                    // Fallback to static data
                    updateStaticMonitoringDisplay();
                }
            } catch (error) {
                console.warn('Error fetching monitoring data:', error);
                updateStaticMonitoringDisplay();
            }
        }

        function updateMonitoringDisplay() {
            // Update service count
            const serviceCountEl = document.getElementById('service-count');
            if (serviceCountEl) {
                serviceCountEl.textContent = monitoringData.services.length || 3;
            }

            // Update uptime percentage
            const uptimeEl = document.getElementById('uptime-percentage');
            if (uptimeEl) {
                uptimeEl.textContent = `${monitoringData.uptime || 95}%`;
                uptimeEl.className = `stat-value ${getUptimeStatusClass(monitoringData.uptime)}`;
            }

            // Update service cards with real status
            updateServiceCards();
        }

        function updateStaticMonitoringDisplay() {
            // Fallback display when monitoring is unavailable
            const serviceCountEl = document.getElementById('service-count');
            if (serviceCountEl) {
                serviceCountEl.textContent = '3';
            }

            const uptimeEl = document.getElementById('uptime-percentage');
            if (uptimeEl) {
                uptimeEl.textContent = '95%';
                uptimeEl.className = 'stat-value status-good';
            }
        }

        function getUptimeStatusClass(uptime) {
            if (uptime >= 99) return 'status-good';
            if (uptime >= 95) return 'status-warning';
            return 'status-error';
        }

        function updateServiceCards() {
            // Update service cards based on monitoring data
            const serviceCards = document.querySelectorAll('.service-card');
            serviceCards.forEach(card => {
                const serviceName = card.querySelector('h3').textContent.toLowerCase();
                const isDown = monitoringData.services.some(service => 
                    service.name.toLowerCase().includes(serviceName) && !service.isUp
                );
                
                if (isDown) {
                    card.classList.add('is-down');
                    if (!card.querySelector('.status-banner')) {
                        const statusBanner = document.createElement('div');
                        statusBanner.className = 'status-banner down';
                        statusBanner.textContent = 'Down';
                        card.insertBefore(statusBanner, card.firstChild);
                    }
                } else {
                    card.classList.remove('is-down');
                    const statusBanner = card.querySelector('.status-banner.down');
                    if (statusBanner) {
                        statusBanner.remove();
                    }
                }
            });
        }

        // Start monitoring updates
        function startMonitoring() {
            fetchMonitoringData(); // Initial fetch
            setInterval(fetchMonitoringData, 30000); // Update every 30 seconds
        }

        // Enhanced notification system
        function showNotification(message, type = 'info', duration = 4000) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icon = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è',
                'info': '‚ÑπÔ∏è'
            }[type] || '‚ÑπÔ∏è';
            
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${icon}</span>
                    <span class="notification-message">${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.classList.add('show'), 10);
            
            // Auto remove
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, duration);
        }

        // Service health checker
        async function checkServiceHealth(url, timeout = 5000) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeout);
                
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'no-cors',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                return true;
            } catch (error) {
                return false;
            }
        }

        // Enhanced service status with health checks
        async function performHealthChecks() {
            const services = [
                { name: 'n8n', url: 'https://n8n.joshi1.com' },
                { name: 'Paperless-ngx', url: 'http://Joshivps1-ocp:8000' },
                { name: 'Uptime Kuma', url: 'https://uptime.joshi1.com' }
            ];

            const healthResults = await Promise.allSettled(
                services.map(async (service) => ({
                    ...service,
                    isHealthy: await checkServiceHealth(service.url)
                }))  
            );

            const healthyServices = healthResults
                .filter(result => result.status === 'fulfilled' && result.value.isHealthy)
                .length;

            const totalServices = services.length;
            
            if (healthyServices < totalServices) {
                showNotification(
                    `${totalServices - healthyServices} service(s) are down`,
                    'warning',
                    6000
                );
            }

            return healthResults;
        }

        // System resource monitoring (mock data for demo)
        function getSystemResources() {
            return {
                cpu: Math.floor(Math.random() * 30) + 20, // 20-50%
                memory: Math.floor(Math.random() * 40) + 30, // 30-70%
                disk: Math.floor(Math.random() * 20) + 60, // 60-80%
                network: Math.floor(Math.random() * 50) + 10 // 10-60%
            };
        }

        // Display system resources in header
        function updateSystemResources() {
            const resources = getSystemResources();
            const systemInfo = document.querySelector('.system-info');
            
            if (systemInfo && !document.getElementById('system-resources')) {
                const resourcesDiv = document.createElement('div');
                resourcesDiv.id = 'system-resources';
                resourcesDiv.className = 'stat';
                resourcesDiv.innerHTML = `
                    <div class="stat-label">Resources</div>
                    <div class="stat-value">
                        <div class="resource-item">
                            <span class="resource-label">CPU</span>
                            <div class="resource-bar">
                                <div class="resource-fill" style="width: ${resources.cpu}%"></div>
                            </div>
                            <span class="resource-value">${resources.cpu}%</span>
                        </div>
                    </div>
                `;
                systemInfo.appendChild(resourcesDiv);
            }
        }

        // Maintenance mode toggle
        function toggleMaintenance() {
            const banner = document.getElementById('maintenance-banner');
            const isVisible = banner.style.display !== 'none';
            
            if (isVisible) {
                banner.style.display = 'none';
                localStorage.setItem('maintenanceMode', 'false');
            } else {
                banner.style.display = 'block';
                localStorage.setItem('maintenanceMode', 'true');
            }
        }
        // Check maintenance mode on page load
        function checkMaintenanceMode() {
            const maintenanceMode = localStorage.getItem('maintenanceMode');
            if (maintenanceMode === 'true') {
                document.getElementById('maintenance-banner').style.display = 'block';
            }
        }

        // Update live time every second
        setInterval(updateLiveTime, 1000);
        
        // Update timestamp every minute
        setInterval(updateTimestamp, 60000);

        // Check maintenance mode on page load
        checkMaintenanceMode();
        
        // Initialize accessibility features
        manageFocus();
        
        // Initialize categories
        initializeCategories();
        updateServiceCounts();
        
        // Set initial values
        updateLiveTime();
        updateTimestamp();
        
        // Start monitoring
        startMonitoring();
        
        // Start health checks
        performHealthChecks();
        
        // Update system resources
        updateSystemResources();
        
        // Welcome notification
        setTimeout(() => {
            showNotification('Dashboard loaded successfully! üöÄ', 'success', 3000);
        }, 1000);

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showNotification('Dashboard update available! Refresh to update.', 'info', 5000);
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });

            // Listen for messages from service worker
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.type === 'SYNC_COMPLETE') {
                    showNotification('Sync completed successfully!', 'success', 2000);
                }
            });
        }
        
        // ========================================
        // ACCESSIBILITY FUNCTIONS
        // ========================================
        
        // Handle keyboard navigation for category headers
        function handleCategoryKeydown(event, categoryId) {
            // Allow Enter and Space to toggle categories
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                toggleCategory(categoryId);
            }
        }
        
        // Announce status changes to screen readers
        function announceStatusChange(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            document.body.appendChild(announcement);
            
            // Remove after announcement
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }
        
        // Focus management for better keyboard navigation
        function manageFocus() {
            // Add focus indicators for keyboard users
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Tab') {
                    document.body.classList.add('keyboard-navigation');
                }
            });
            
            // Remove focus indicators for mouse users
            document.addEventListener('mousedown', function() {
                document.body.classList.remove('keyboard-navigation');
            });
        }

        // ========================================
        // SERVICE CATEGORY MANAGEMENT
        // ========================================
        
        function toggleCategory(categoryId) {
            const content = document.getElementById(`${categoryId}-content`);
            const toggleIcon = document.querySelector(`[data-category="${categoryId}"] .toggle-icon`);
            const category = document.querySelector(`[data-category="${categoryId}"]`);
            const header = category.querySelector('.category-header');
            
            if (content.style.display === 'none' || content.style.display === '') {
                // Expand category
                content.style.display = 'block';
                toggleIcon.textContent = '‚ñº';
                category.classList.add('expanded');
                category.classList.remove('collapsed');
                header.setAttribute('aria-expanded', 'true');
                
                // Store preference
                localStorage.setItem(`category-${categoryId}-expanded`, 'true');
                
                // Announce to screen readers
                const categoryName = category.querySelector('h2').textContent;
                announceStatusChange(`${categoryName} category expanded`);
            } else {
                // Collapse category
                content.style.display = 'none';
                toggleIcon.textContent = '‚ñ∂';
                category.classList.add('collapsed');
                category.classList.remove('expanded');
                header.setAttribute('aria-expanded', 'false');
                
                // Store preference
                localStorage.setItem(`category-${categoryId}-expanded`, 'false');
                
                // Announce to screen readers
                const categoryName = category.querySelector('h2').textContent;
                announceStatusChange(`${categoryName} category collapsed`);
            }
        }





        // Initialize category states from localStorage
        function initializeCategories() {
            const categories = ['core', 'monitoring', 'family'];
            categories.forEach(categoryId => {
                const isExpanded = localStorage.getItem(`category-${categoryId}-expanded`);
                const content = document.getElementById(`${categoryId}-content`);
                const toggleIcon = document.querySelector(`[data-category="${categoryId}"] .toggle-icon`);
                const category = document.querySelector(`[data-category="${categoryId}"]`);
                
                // Default to expanded for first time users
                if (isExpanded === null) {
                    content.style.display = 'block';
                    toggleIcon.textContent = '‚ñº';
                    category.classList.add('expanded');
                } else if (isExpanded === 'true') {
                    content.style.display = 'block';
                    toggleIcon.textContent = '‚ñº';
                    category.classList.add('expanded');
                } else {
                    content.style.display = 'none';
                    toggleIcon.textContent = '‚ñ∂';
                    category.classList.add('collapsed');
                }
            });
        }

        function updateServiceCounts() {
            const coreCount = document.querySelectorAll('[data-category="core"] .service-card').length;
            const monitoringCount = document.querySelectorAll('[data-category="monitoring"] .analytics-card').length;
            const familyCount = document.querySelectorAll('[data-category="family"] .service-card').length;
            
            document.getElementById('core-count').textContent = coreCount;
            document.getElementById('monitoring-count').textContent = monitoringCount;
            document.getElementById('family-count').textContent = familyCount;
        }

        // Console warning
        console.log('%cSTOP!', 'color: red; font-size: 50px; font-weight: bold;');
        console.log('%cThis is a browser feature intended for developers. Unauthorized access is prohibited.', 'color: red; font-size: 16px;');
        
        // Enhanced theme handling with animations
        (function() {
            const storageKey = 'theme-preference';
            const getSystemPreference = () => window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
            const getPreference = () => localStorage.getItem(storageKey) || getSystemPreference();
            
            const applyTheme = (theme) => {
                const isLight = theme === 'light';
                document.documentElement.setAttribute('data-theme', isLight ? 'light' : 'dark');
                
                // Enhanced button animation
                const btn = document.getElementById('theme-toggle');
                if (btn) {
                    btn.style.transform = 'rotate(180deg)';
                    setTimeout(() => {
                        btn.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
                        btn.style.transform = 'rotate(0deg)';
                    }, 150);
                }
                
                // Add theme change animation class
                document.body.classList.add('theme-transitioning');
                setTimeout(() => {
                    document.body.classList.remove('theme-transitioning');
                }, 300);
            };

            // Initialize with smooth transition
            const initialTheme = getPreference();
            applyTheme(initialTheme);

            // Enhanced toggle with haptic feedback
            const toggleBtn = document.getElementById('theme-toggle');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Haptic feedback on mobile
                    if ('vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                    
                    const current = document.documentElement.getAttribute('data-theme');
                    const next = current === 'light' ? 'dark' : 'light';
                    localStorage.setItem(storageKey, next);
                    applyTheme(next);
                    
                    // Show brief notification
                    showThemeNotification(next);
                });
            }

            // Respond to system changes with smooth transition
            if (window.matchMedia) {
                const media = window.matchMedia('(prefers-color-scheme: light)');
                media.addEventListener && media.addEventListener('change', function() {
                    if (!localStorage.getItem(storageKey)) {
                        applyTheme(getSystemPreference());
                    }
                });
            }

            // Theme change notification
            function showThemeNotification(theme) {
                const notification = document.createElement('div');
                notification.className = 'theme-notification';
                notification.innerHTML = `
                    <div class="theme-notification-content">
                        <span class="theme-icon">${theme === 'light' ? '‚òÄÔ∏è' : 'üåô'}</span>
                        <span class="theme-text">Switched to ${theme} mode</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => notification.classList.add('show'), 10);
                
                // Remove after delay
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            }
        })();

        // Command palette / Search (‚åòK / Ctrl+K)
        (function() {
            var overlay = document.getElementById('search-overlay');
            var input = null;
            var list = null;
            var items = [];
            var focusedIndex = -1;

            function collectEntries() {
                var links = document.querySelectorAll('.service-card, .analytics-card');
                var entries = [];
                links.forEach(function(link) {
                    var isDown = link.classList.contains('is-down') || link.querySelector('.status-banner.down');
                    var titleEl = link.querySelector('h3');
                    var descEl = link.querySelector('p');
                    entries.push({
                        title: titleEl ? titleEl.textContent.trim() : (link.getAttribute('href') || 'Link'),
                        desc: descEl ? descEl.textContent.trim() : '',
                        href: link.getAttribute('href') || '#',
                        disabled: !!isDown
                    });
                });
                return entries;
            }

            function renderList(entries) {
                list.innerHTML = '';
                items = entries;
                focusedIndex = -1;
                entries.forEach(function(entry, idx) {
                    var li = document.createElement('button');
                    li.type = 'button';
                    li.className = 'search-item' + (entry.disabled ? ' disabled' : '');
                    li.setAttribute('data-index', String(idx));
                    li.innerHTML = '<div class="search-item-title">' + entry.title + '</div>' +
                                   (entry.desc ? '<div class="search-item-desc">' + entry.desc + '</div>' : '');
                    if (!entry.disabled) {
                        li.addEventListener('click', function(){ window.open(entry.href, '_blank', 'noopener'); close(); });
                    }
                    list.appendChild(li);
                });
            }

            function filter(term) {
                var all = collectEntries();
                var t = term.trim().toLowerCase();
                if (!t) return renderList(all);
                renderList(all.filter(function(e){
                    return e.title.toLowerCase().includes(t) || e.desc.toLowerCase().includes(t) || e.href.toLowerCase().includes(t);
                }));
            }

            function open() {
                if (!overlay) return;
                overlay.style.display = 'flex';
                setTimeout(function(){ overlay.classList.add('visible'); }, 0);
                input = document.getElementById('search-input');
                list = document.getElementById('search-results');
                filter('');
                setTimeout(function(){ input && input.focus(); }, 50);
            }

            function close() {
                if (!overlay) return;
                overlay.classList.remove('visible');
                setTimeout(function(){ overlay.style.display = 'none'; }, 150);
            }

            function moveFocus(delta) {
                var buttons = Array.prototype.slice.call(list.querySelectorAll('.search-item'));
                if (!buttons.length) return;
                var next = focusedIndex + delta;
                if (next < 0) next = buttons.length - 1;
                if (next >= buttons.length) next = 0;
                focusedIndex = next;
                buttons.forEach(function(b){ b.classList.remove('focused'); });
                var target = buttons[focusedIndex];
                target.classList.add('focused');
                target.scrollIntoView({ block: 'nearest' });
            }

            // Open via keyboard
            document.addEventListener('keydown', function(e){
                var isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
                var cmdOrCtrl = isMac ? e.metaKey : e.ctrlKey;
                if (cmdOrCtrl && (e.key === 'k' || e.key === 'K')) {
                    e.preventDefault();
                    open();
                }
                if (e.key === 'Escape' && overlay && overlay.classList.contains('visible')) {
                    e.preventDefault();
                    close();
                }
            });

            // Open via button
            var openBtn = document.getElementById('search-open');
            if (openBtn) openBtn.addEventListener('click', open);

            // Overlay interactions
            document.addEventListener('click', function(e){
                if (!overlay || overlay.style.display === 'none') return;
                if (e.target === overlay) close();
            });

            document.addEventListener('keydown', function(e){
                if (!overlay || overlay.style.display === 'none') return;
                if (e.key === 'ArrowDown') { e.preventDefault(); moveFocus(1); }
                if (e.key === 'ArrowUp') { e.preventDefault(); moveFocus(-1); }
                if (e.key === 'Enter') {
                    var buttons = Array.prototype.slice.call(document.querySelectorAll('.search-item'));
                    var target = buttons[focusedIndex];
                    if (target && !target.classList.contains('disabled')) {
                        var idx = parseInt(target.getAttribute('data-index') || '-1', 10);
                        if (idx >= 0 && items[idx]) { window.open(items[idx].href, '_blank', 'noopener'); close(); }
                    }
                }
            });

            document.addEventListener('input', function(e){
                if (e.target && e.target.id === 'search-input') {
                    filter(e.target.value || '');
                }
            });
        })();
    </script>

    <!-- Search Modal -->
    <div id="search-overlay" class="modal-overlay" style="display: none;" aria-hidden="true">
        <div class="modal search-modal" role="dialog" aria-modal="true" aria-labelledby="search-title">
            <div class="search-header">
                <input id="search-input" type="text" class="search-input" placeholder="Search services (‚åòK)" aria-label="Search services" autocomplete="off" spellcheck="false" />
            </div>
            <div class="search-body">
                <div id="search-results" class="search-results" role="listbox"></div>
            </div>
        </div>
    </div>



    <!-- Maintenance Toggle Button (Bottom) -->
    <div class="maintenance-toggle-bottom">
        <button class="maintenance-btn-bottom" onclick="toggleMaintenance()" title="Toggle Maintenance Mode">
            <span class="maintenance-icon">üîß</span>
            <span class="maintenance-text">Maintenance</span>
        </button>
    </div>
</body>
</html>